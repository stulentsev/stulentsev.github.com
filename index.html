
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Byte Friendly</title>
  <meta name="author" content="Sergio Tulentsev">

  
  <meta name="description" content="Today I just wanted to share some tools that I use to read documentation. First one is Dash. It&#8217;s an offline documentation browser which &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tech.tulentsev.com/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/ByteFriendly" rel="alternate" title="Byte Friendly" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-203037-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Byte Friendly</a></h1>
  
    <h2>Thoughts on programming, scalability and other stuff.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/ByteFriendly" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tech.tulentsev.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/03/useful-documentation-lookup-tools/">Useful Documentation Lookup Tools</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-04T23:20:00+04:00" pubdate data-updated="true">Mar 4<span>th</span>, 2014</time>
        
         | <a href="/2014/03/useful-documentation-lookup-tools/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Today I just wanted to share some tools that I use to read documentation.</p>

<p>First one is <a href="http://kapeli.com/dash">Dash</a>. It&#8217;s an offline documentation browser which contains many different topics. It has ruby, rails, CSS, HAML, jQuery, Go, Haskell and everything else you might want. It can also index locally installed rubygems. And did I mention that it is offline? If you&#8217;re anything like me, you need to consult documentation every 30 seconds. And with this tool you can even work on a plane! Can&#8217;t recommend enough.</p>

<p>Another one is for ruby only, <a href="http://www.omniref.com/">OmniRef</a>. These guys have indexed every ruby gem there is and cross-linked the documentation. On the site you can <em>easily</em> switch between version of a gem (or ruby) and see how documented behaviour and/or code changed over time. It also allows leaving notes (user generated content?), but I don&#8217;t see many notes at the moment. Potentially, these comments can be an excellent complement to the official documentation (we see this with, say, MySQL docs).</p>

<p>And, of course, the most important tool for me these days is <a href="http://stackoverflow.com">StackOverflow</a>. More than half of my google searches lead to this chest of collective programming wisdom. The funniest moments are when I struggle with something, then google points me to stackoverflow where I find an answer that <em>I posted myself</em> some time ago. Can you believe this? :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/02/limitations-of-mongodb/">Limitations of MongoDB</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-25T13:18:00+04:00" pubdate data-updated="true">Feb 25<span>th</span>, 2014</time>
        
         | <a href="/2014/02/limitations-of-mongodb/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>MongoDB is becoming even more popular than it is now. More people want to learn about it. So I was preparing a seminar for this company and I had to compile a list of MongoDB limits. I never knew there were so many! Some of them are reasonable, some are weird. Anyway, it&#8217;s good to know them. Here&#8217;s a list of MongoDB limits as of version 2.4.9:</p>

<ul>
<li>Max document size: 16 MB (we all knew this one, right?)</li>
<li>Max document nesting level: 100 (documents inside documents inside documents&#8230;)</li>
<li>Namespace is limited to ~123 chars (namespace is db_name + collection_name (or index_name))</li>
<li>DB name is limited to 64 chars</li>
<li>Default .ns file can store about 24000 namespaces (again, a namespace is referring to a collection or an index)</li>
<li>If you index some field, that field can&#8217;t contain more than 1024 bytes</li>
<li>Max 64 indexes per collection</li>
<li>Max 31 fields in a compound index</li>
<li>fulltext search and geo indexes are mutually exclusive (you can&#8217;t use both in the same query)</li>
<li>If you set a limit of documents in a capped collection, this limit can&#8217;t be more than 2**32. Otherwise, number of documents is unlimited.</li>
<li>On linux, one mongod instance can&#8217;t store more than 64 TB of data (128 TB without journal)</li>
<li>On windows, mongod can&#8217;t store more than 4 TB of data (8 TB without journal)</li>
<li>Max 12 nodes in a replica set</li>
<li>Max 7 voting nodes in a replica set</li>
<li>You can&#8217;t automatically rollback more than 300 MB of data. If you have more than this, manual invervention is needed.</li>
<li><code>group</code> command doesn&#8217;t work in sharded cluster.</li>
<li>db.eval() doesn&#8217;t work on sharded collections. Works on unsharded, though.</li>
<li><code>$isolated</code>, <code>$snapshot</code>, geoSearch don&#8217;t work in a sharded cluster.</li>
<li>You can&#8217;t refer <code>db</code> object in <code>$where</code> functions.</li>
<li>If you want to shard a collection, it must be smaller than 256 GB, or else it will likely fail to shard.</li>
<li>Individual (not multi) updates/removes in a sharded cluster must include shard key. Multi versions of these commands may not include shard key.</li>
<li>Max 512 bytes for shard key values</li>
<li>You can&#8217;t change shard key for a collection once it&#8217;s sharded.</li>
<li>You can&#8217;t change value of a shard key of a document.</li>
<li>aggregate/$sort produces error if sorting takes more than 10 percent of RAM.</li>
<li>You can&#8217;t use $or in 2d geo queries</li>
<li>You better not use queries with multiple $in parts. If this results in more than 4 million combinations - you get error.</li>
<li>Database names are case-sensitive (even on case-insensitive file systems)</li>
<li>Forbidden characters in database names: linux - /. &#8220;, windows - /. &#8220;*&lt;>:|?</li>
<li>Forbidden characters in collection names: $ sign, &#8220;system.&#8221; prefix</li>
<li>Forbidden characters in field names: .$</li>
<li>Hashed index can&#8217;t be unique</li>
<li>Max connection number is hardcoded to 20k.</li>
</ul>


<p>Hope this was useful to you.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/02/kata-convert-numbers-to-roman-numerals/">Kata: Convert Numbers to Roman Numerals</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-08T10:24:00+04:00" pubdate data-updated="true">Feb 8<span>th</span>, 2014</time>
        
         | <a href="/2014/02/kata-convert-numbers-to-roman-numerals/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Here is an interesting problem: write a program that converts numbers into <a href="http://en.wikipedia.org/wiki/Roman_numerals">Roman numerals</a>. Roman didn&#8217;t use Arabic numbers. Instead they used symbols of Latin alphabet that represented different values. It&#8217;s a simple system. &#8220;I&#8221; stands for 1, &#8220;V&#8221; stands for 5, &#8220;X&#8221; for 10 and so on. To represent 2 you have to use &#8220;II&#8221; (1 + 1), to represent 7 you use &#8220;VII&#8221; (5 + 1 + 1). Simple, right? Well, no. Here&#8217;s a twist.</p>

<pre>
* 4 is "IV" (not "IIII")
* 9 is "IX" (not "VIIII")
* 40 is "XL" (not "XXXX")
* 49 is "XLIX" (not "XXXXVIIII")
</pre>


<p>Weird, huh? Maybe they didn&#8217;t like 4 identical symbols in a row, who knows. Anyway, how can we solve this?</p>

<p>After trying out several &#8220;smart&#8221; solutions and failing, I&#8217;ve come up with this simple solution: store these special cases along with normal ones and keep subtracting from the number until it&#8217;s zero.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">romanize</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
</span><span class='line'>  <span class="n">reductions</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="mi">1000</span> <span class="o">=&gt;</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="mi">900</span> <span class="o">=&gt;</span> <span class="s1">&#39;CM&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>    <span class="mi">500</span> <span class="o">=&gt;</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="mi">400</span> <span class="o">=&gt;</span> <span class="s1">&#39;CD&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>    <span class="mi">100</span> <span class="o">=&gt;</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="mi">90</span> <span class="o">=&gt;</span> <span class="s1">&#39;XC&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>    <span class="mi">50</span> <span class="o">=&gt;</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="mi">40</span> <span class="o">=&gt;</span> <span class="s1">&#39;XL&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>    <span class="mi">10</span> <span class="o">=&gt;</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="mi">9</span> <span class="o">=&gt;</span> <span class="s1">&#39;IX&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>    <span class="mi">5</span> <span class="o">=&gt;</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="mi">4</span> <span class="o">=&gt;</span> <span class="s1">&#39;IV&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>    <span class="mi">1</span> <span class="o">=&gt;</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">while</span> <span class="n">number</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span class='line'>    <span class="n">reductions</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">n</span><span class="p">,</span> <span class="n">subst</span><span class="o">|</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">number</span> <span class="o">/</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="c1"># if number contains at least one of n</span>
</span><span class='line'>        <span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="n">subst</span>  <span class="c1"># push corresponding symbol to result</span>
</span><span class='line'>        <span class="n">number</span> <span class="o">-=</span> <span class="n">n</span>
</span><span class='line'>        <span class="k">break</span>            <span class="c1"># break from each and start it anew </span>
</span><span class='line'>                         <span class="c1"># so that the largest numbers are checked first again.</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">result</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>A test:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">test_mapping</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="mi">1</span> <span class="o">=&gt;</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">2</span> <span class="o">=&gt;</span> <span class="s1">&#39;II&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">3</span> <span class="o">=&gt;</span> <span class="s1">&#39;III&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">4</span> <span class="o">=&gt;</span> <span class="s1">&#39;IV&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">5</span> <span class="o">=&gt;</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">6</span> <span class="o">=&gt;</span> <span class="s1">&#39;VI&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">7</span> <span class="o">=&gt;</span> <span class="s1">&#39;VII&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">8</span> <span class="o">=&gt;</span> <span class="s1">&#39;VIII&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">9</span> <span class="o">=&gt;</span> <span class="s1">&#39;IX&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">10</span> <span class="o">=&gt;</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">11</span> <span class="o">=&gt;</span> <span class="s1">&#39;XI&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">12</span> <span class="o">=&gt;</span> <span class="s1">&#39;XII&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">13</span> <span class="o">=&gt;</span> <span class="s1">&#39;XIII&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">14</span> <span class="o">=&gt;</span> <span class="s1">&#39;XIV&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">15</span> <span class="o">=&gt;</span> <span class="s1">&#39;XV&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">19</span> <span class="o">=&gt;</span> <span class="s1">&#39;XIX&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">22</span> <span class="o">=&gt;</span> <span class="s1">&#39;XXII&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">29</span> <span class="o">=&gt;</span> <span class="s1">&#39;XXIX&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">30</span> <span class="o">=&gt;</span> <span class="s1">&#39;XXX&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">40</span> <span class="o">=&gt;</span> <span class="s1">&#39;XL&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">49</span> <span class="o">=&gt;</span> <span class="s1">&#39;XLIX&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">99</span> <span class="o">=&gt;</span> <span class="s1">&#39;XCIX&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">950</span> <span class="o">=&gt;</span> <span class="s1">&#39;CML&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="mi">2014</span> <span class="o">=&gt;</span> <span class="s1">&#39;MMXIV&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">test_mapping</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">|</span>
</span><span class='line'>  <span class="n">res</span> <span class="o">=</span> <span class="n">romanize</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span class='line'>  <span class="n">sign</span> <span class="o">=</span> <span class="n">res</span> <span class="o">==</span> <span class="n">v</span> <span class="p">?</span> <span class="s1">&#39;.&#39;</span> <span class="p">:</span> <span class="s1">&#39;F&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">sign</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">k</span><span class="si">}</span><span class="s2"> =&gt; </span><span class="si">#{</span><span class="n">res</span><span class="o">.</span><span class="n">inspect</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This simple problem took me a little bit over 2 hours to come up with this (simple) solution. Too bad, that often we, programmers, don&#8217;t have time to look for simple solutions and we go for the easiest one.</p>

<p>Hope this helps someone.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/02/what-is-utf-8-for-the-dummies/">What Is UTF-8 (for the Dummies)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-03T09:41:00+04:00" pubdate data-updated="true">Feb 3<span>rd</span>, 2014</time>
        
         | <a href="/2014/02/what-is-utf-8-for-the-dummies/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I must admit, I didn&#8217;t really understand what Unicode (more specifically, its flavor &#8220;UTF-8&#8221;) actually is. All I knew was that it&#8217;s a good encoding and it&#8217;s compatible with ASCII. Beyond that - no clue. This video has made it crystal clear.</p>

<iframe width="560" height="315" src="//www.youtube.com/embed/MijmeoH9LT4" frameborder="0" allowfullscreen></iframe>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/11/pipeline-processing-in-go/">Pipeline Processing in Go</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-04T12:13:00+04:00" pubdate data-updated="true">Nov 4<span>th</span>, 2013</time>
        
         | <a href="/2013/11/pipeline-processing-in-go/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Pipeline processing is a very powerful design idiom. You have some simple building blocks that you can arrange in different combinations to perform complex tasks. A classic example of that is unix command line. Each tool is very simple. It does only job. But it still amazes me regularly, what you can achieve by simply combining those tools into a pipeline and feeding/piping data through it.</p>

<p>Say, you&#8217;re building an RSS reader that shows new posts live. Implementing it in a regular procedural manner is easy. Something like this (pseudo-code):</p>

<pre>
  loop {
    fetch posts
    for each post {
      if we have not yet seen this post {
        mark post seen
        show it to user
      }
    }
  }
</pre>


<p>Say, now we want to do a focused reading. Which means that we only want to see a subset of posts which satisfy some arbitrary criteria (filter by tags, etc.). No problemo, we just add one conditional in there.</p>

<pre>
  loop {
    fetch posts
    for each post {
      if post is interesting {
        if we have not yet seen this post {
          mark post seen
          show it to user
        }
      }
    }
  }
</pre>


<p>Now it&#8217;s getting a little bit difficult to read and it will get worse. All business rules are in the same pile of code and it may be difficult to tell them apart.</p>

<p>But if you think about it, there is a pipeline that consists of several primitive segments:</p>

<p><img class="center" src="/images/uploads/2013/11/04/simple_pipeline.png"></p>

<p>Each individual block is completely separate from each other (well, maybe except that &#8220;select unseen&#8221; and &#8220;mark all seen&#8221; might use the same storage). If we were to, say, remove caching (and stop serving cached content), we&#8217;d only have to take out those two segments. If we want to change how content is presented to user (print to terminal, send to text-to-speect engine, &#8230;), we only have to replace the final segment. The rest of the pipeline stays untouched. And the aforementioned tag filtering - we just insert it after fetcher:</p>

<p><img class="center" src="/images/uploads/2013/11/04/pipeline_with_filter.png"></p>

<p>In the pipeline, each segment can either swallow a message or pass it on (after applying some transformation (optional)). Two simple rules, infinite flexibility.</p>

<p>Go language allows for natural expression of this design: goroutines as segments, connected by channels.</p>

<p>Here&#8217;s an intentionally primitive example, which filters and transforms a stream of integers.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="k">package</span> <span class="n">main</span>
</span><span class='line'>
</span><span class='line'><span class="k">import</span> <span class="p">(</span>
</span><span class='line'>  <span class="s">&quot;fmt&quot;</span>
</span><span class='line'>  <span class="s">&quot;time&quot;</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// type alias for our pipeline segment</span>
</span><span class='line'><span class="c1">// segment is a function that reads from a stream of integers</span>
</span><span class='line'><span class="c1">//  and writes to a stream of integers</span>
</span><span class='line'><span class="k">type</span> <span class="n">pipelineSegment</span> <span class="k">func</span><span class="p">(</span><span class="n">in</span><span class="p">,</span> <span class="n">out</span> <span class="k">chan</span> <span class="nb">int</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// construct our pipeline. Put generator first, then filters/modifiers</span>
</span><span class='line'>  <span class="n">out</span> <span class="p">:=</span> <span class="n">makePipeline</span><span class="p">(</span><span class="n">generator</span><span class="p">,</span> <span class="n">onlyOdd</span><span class="p">,</span> <span class="n">plusOne</span><span class="p">,</span> <span class="n">squared</span><span class="p">,</span> <span class="n">plusOne</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">for</span> <span class="n">v</span> <span class="p">:=</span> <span class="k">range</span> <span class="n">out</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">fmt</span><span class="p">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">&quot;Resulting value: %d\n&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// This simply generates sequential integers in infinite loop.</span>
</span><span class='line'><span class="k">func</span> <span class="n">generator</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">out</span> <span class="k">chan</span> <span class="nb">int</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">i</span> <span class="p">:=</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">for</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">out</span> <span class="p">&lt;-</span> <span class="n">i</span>
</span><span class='line'>    <span class="n">i</span> <span class="p">+=</span> <span class="mi">1</span>
</span><span class='line'>    <span class="n">time</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="mi">100</span> <span class="p">*</span> <span class="n">time</span><span class="p">.</span><span class="n">Millisecond</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Filter. Selects only odd integers. Even integers are swallowed.</span>
</span><span class='line'><span class="k">func</span> <span class="n">onlyOdd</span><span class="p">(</span><span class="n">in</span><span class="p">,</span> <span class="n">out</span> <span class="k">chan</span> <span class="nb">int</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">defer</span> <span class="nb">close</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</span><span class='line'>  <span class="k">for</span> <span class="n">val</span> <span class="p">:=</span> <span class="k">range</span> <span class="n">in</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">val</span><span class="p">%</span><span class="mi">2</span> <span class="p">==</span> <span class="mi">1</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">out</span> <span class="p">&lt;-</span> <span class="n">val</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Modifier. Adds 1 and passes on.</span>
</span><span class='line'><span class="k">func</span> <span class="n">plusOne</span><span class="p">(</span><span class="n">in</span><span class="p">,</span> <span class="n">out</span> <span class="k">chan</span> <span class="nb">int</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">defer</span> <span class="nb">close</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</span><span class='line'>  <span class="k">for</span> <span class="n">val</span> <span class="p">:=</span> <span class="k">range</span> <span class="n">in</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">out</span> <span class="p">&lt;-</span> <span class="n">val</span> <span class="p">+</span> <span class="mi">1</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Modifier. Passes a square of incoming integer.</span>
</span><span class='line'><span class="k">func</span> <span class="n">squared</span><span class="p">(</span><span class="n">in</span><span class="p">,</span> <span class="n">out</span> <span class="k">chan</span> <span class="nb">int</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">defer</span> <span class="nb">close</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</span><span class='line'>  <span class="k">for</span> <span class="n">val</span> <span class="p">:=</span> <span class="k">range</span> <span class="n">in</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">out</span> <span class="p">&lt;-</span> <span class="n">val</span> <span class="p">*</span> <span class="n">val</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Generates pipeline out of individual segments. </span>
</span><span class='line'><span class="c1">// Returns an &quot;exhaust pipe&quot;, from which fully processed integers can be read.</span>
</span><span class='line'><span class="k">func</span> <span class="n">makePipeline</span><span class="p">(</span><span class="n">segments</span> <span class="p">...</span><span class="n">pipelineSegment</span><span class="p">)</span> <span class="p">(</span><span class="n">out</span> <span class="k">chan</span> <span class="nb">int</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">current_input</span> <span class="p">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="nb">int</span><span class="p">)</span>
</span><span class='line'>  <span class="k">var</span> <span class="n">current_output</span> <span class="k">chan</span> <span class="nb">int</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">seg</span> <span class="p">:=</span> <span class="k">range</span> <span class="n">segments</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">current_output</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="nb">int</span><span class="p">)</span>
</span><span class='line'>    <span class="k">go</span> <span class="n">seg</span><span class="p">(</span><span class="n">current_input</span><span class="p">,</span> <span class="n">current_output</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">current_input</span> <span class="p">=</span> <span class="n">current_output</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="n">current_output</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Produced output:</p>

<pre>
  Resulting value: 5
  Resulting value: 17
  Resulting value: 37
  Resulting value: 65
  Resulting value: 101
  Resulting value: 145
  Resulting value: 197
  ...
</pre>


<p>First generated integer is 0. It&#8217;s even (well, certainly not odd), so it does not make it past filter.</p>

<p>Next one is 1. It passes filter. Then it gets +1, so it&#8217;s now 2. Then it&#8217;s squared and becomes 4. And finally, one more +1 which results in 5. There are no more segments, so this value is read from the output pipe and printed to terminal.</p>

<p>Hope this was useful.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/10/hide-slash-exclude-directories-in-textmate-2/">Hide/exclude Directories in TextMate 2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-30T10:24:00+04:00" pubdate data-updated="true">Oct 30<span>th</span>, 2013</time>
        
         | <a href="/2013/10/hide-slash-exclude-directories-in-textmate-2/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I decided to give TextMate 2 another try today. Hopefully it won&#8217;t freeze upon trying to install a bundle like it did last time. Now I don&#8217;t recall which bundle was that, but so far things are going well. Mostly.</p>

<p>When I opened my Rails app and tried to navigate to file (<code>Cmd+T</code>), I saw this:</p>

<p><img class="center" src="/images/uploads/2013/10/30/tm2_tmp_files.png"></p>

<p>At first I thought that these are files from <code>.git</code> folder and spent embarrassing amount of time trying to make TM2 hide that folder. But these are actually temp asset files generated by Sprockets and they reside in <code>tmp/assets/...</code>.</p>

<p>Long story short, here&#8217;s how you can hide a directory in TextMate 2, both from project browser and navigation dialog.</p>

<p>Create a <code>.tm_properties</code> file. It can be in current project dir or any parent dir (up to <code>$HOME</code>). Put this line into it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>excludeDirectories = "{tmp,}"</span></code></pre></td></tr></table></div></figure>


<p>It is worth noting that <code>"{tmp}"</code> doesn&#8217;t work. Apparently, TextMate glob parser breaks down if it can&#8217;t find a comma. So we add one. Alternatively we can use this line:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>excludeDirectories = "{$excludeDirectories,tmp}"</span></code></pre></td></tr></table></div></figure>


<p>It will amend an existing <code>excludeDirectories</code> setting (empty string by default) instead of replacing. And it also has a comma. :)</p>

<p>Hope this post saved you some time.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/03/move-capistranos-log-directory/">Move Capistrano&#8217;s Log Directory</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-11T14:34:00+04:00" pubdate data-updated="true">Mar 11<span>th</span>, 2013</time>
        
         | <a href="/2013/03/move-capistranos-log-directory/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So you want to move your log directory? To a separate volume, maybe? But you are afraid that it will break too many things, like all those libraries with <code>#{rails_root}/log</code> paths hardcoded in them? Fear not, there&#8217;s a simple workaround.</p>

<p>As you probably know, capistrano aliases your rails log dir to a shared dir outside of app folder.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ln -s /deploy_path/shared/log /deploy_path/current/log</span></code></pre></td></tr></table></div></figure>


<p>This means that, in fact, all your logs turn up at <code>/deploy_path/shared/log/</code>. Now all we need is to symlink that dir as well!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo mkdir /var/log/yourapp
</span><span class='line'>
</span><span class='line'><span class="c"># make it writable to the app</span>
</span><span class='line'>sudo chown -R youruser:yourgroup /var/log/yourapp/
</span><span class='line'>
</span><span class='line'><span class="c"># deal with existing log dir (I back it up, but you can remove it, or copy the files to </span>
</span><span class='line'><span class="c">#   the new location)</span>
</span><span class='line'>mv /deploy_path/shared/log /deploy_path/shared/log_
</span><span class='line'>ln -s /var/log/yourapp /deploy_path/shared/log
</span></code></pre></td></tr></table></div></figure>


<p>Hope this helps :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/02/cap-deploy-from-an-arbitrary-branch/">Cap Deploy From an Arbitrary Branch</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-22T12:34:00+04:00" pubdate data-updated="true">Feb 22<span>nd</span>, 2013</time>
        
         | <a href="/2013/02/cap-deploy-from-an-arbitrary-branch/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As you know, capistrano can deploy your app from a specific branch in the repo. You just have to specify it</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">set</span> <span class="ss">:branch</span><span class="p">,</span> <span class="s1">&#39;develop&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you develop in a single branch, that should do it for you. All commits go to one branch and all deploys are likely served by the same branch. This is a simple model, good enough for small projects.</p>

<p>However, if you adopt <a href="http://nvie.com/posts/a-successful-git-branching-model/">git flow</a>, it encourages you (not to say &#8220;forces&#8221;) to have separate branch for every feature, release or hotfix that you&#8217;re working on. And, naturally, you want to deploy to dev/staging server right from a feature branch, not having to merge it first to develop/master. This is trivial to accomplish, just change the branch name:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">set</span> <span class="ss">:branch</span><span class="p">,</span> <span class="s1">&#39;feature/my-test-feature&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now you have a pending file change. What do you do with it? Commit to source control? That increases file churn rate for absolutely no reason. <code>git checkout</code> that file? This is an extra action, of which you will be tired quite soon (not to mention chance to accidentally commit the file).</p>

<p>Solution? Externalize the setting. When deploying, look in the environment for a branch to use and fallback to default name.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">set</span> <span class="ss">:branch</span><span class="p">,</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;BRANCH&#39;</span><span class="o">]</span> <span class="o">||</span> <span class="s2">&quot;develop&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then you do this</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">BRANCH</span><span class="o">=</span>feature/my-test-feature cap deploy
</span></code></pre></td></tr></table></div></figure>


<p>Or, if you have multistage enabled</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">BRANCH</span><span class="o">=</span>feature/my-test-feature cap staging deploy
</span></code></pre></td></tr></table></div></figure>


<p>Of course, this requires a bit more typing on each deploy, but at the same time it decreases chances of deploying from a wrong branch.</p>

<p>Happy deploying!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/12/sorting-humanized-numbers-in-tablesorter-dot-js/">Sorting Humanized Numbers in tablesorter.js</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-23T17:48:00+04:00" pubdate data-updated="true">Dec 23<span>rd</span>, 2012</time>
        
         | <a href="/2012/12/sorting-humanized-numbers-in-tablesorter-dot-js/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://tablesorter.com/docs/">Tablesorter</a> is a jQuery plugin for sorting tables. It appeared first in a couple of &#8220;X jquery table sorting plugins&#8221; blog posts, so I went with it when I needed to sort a table a couple of days ago.</p>

<p>It works pretty well out of the box and it even lets you customize some bits. One of those bits is column parser: if you have special data in a column, you need a special way to sort it.</p>

<p>Here&#8217;s <a href="http://tablesorter.com/docs/example-parsers.html">an official example</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// add parser through the tablesorter addParser method </span>
</span><span class='line'><span class="nx">$</span><span class="p">.</span><span class="nx">tablesorter</span><span class="p">.</span><span class="nx">addParser</span><span class="p">({</span>
</span><span class='line'>    <span class="c1">// set a unique id </span>
</span><span class='line'>    <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;grades&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">is</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// return false so this parser is not auto detected </span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">format</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// format your data for normalization </span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/good/</span><span class="p">,</span><span class="mi">2</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/medium/</span><span class="p">,</span><span class="mi">1</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/bad/</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="c1">// set type, either numeric or text </span>
</span><span class='line'>    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;numeric&#39;</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">).</span><span class="nx">tablesorter</span><span class="p">({</span>
</span><span class='line'>        <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="mi">6</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">sorter</span><span class="o">:</span><span class="s1">&#39;grades&#39;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>However, it leaves much to be desired. Like what to do when I want my parser to be auto-detected. Turns out that this <code>is</code> function is a predicate. It accepts a string and decides whether it can be handled by this parser. Then the <code>format</code> function will make conversion to a normalized textual/numeric form.</p>

<p>In my case I have a table with a lot of numbers. And those numbers are in humanized form. That is, instead of <code>121738</code> I output <code>121.74k</code>. This format is not properly sortable as either number or text, so I wrote a parser.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">.</span><span class="nx">tablesorter</span><span class="p">.</span><span class="nx">addParser</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;humannum&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">is</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="sr">/^[\d\.]+[Mk]?$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">format</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">is_m</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">is_k</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">fl</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">fl</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">is_m</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">res</span> <span class="o">=</span> <span class="nx">fl</span> <span class="o">*</span> <span class="mi">1000000</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">is_k</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">res</span> <span class="o">=</span> <span class="nx">fl</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;numeric&#39;</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>It basically checks if a string consists of a number followed by an optional &#8220;M&#8221; or &#8220;k&#8221; and, if that&#8217;s the case, converts it to a &#8220;full&#8221; number.</p>

<p>I wish this was in the official doc.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/12/queue-prioritization-in-sidekiq/">Queue Prioritization in Sidekiq</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-17T04:47:00+04:00" pubdate data-updated="true">Dec 17<span>th</span>, 2012</time>
        
         | <a href="/2012/12/queue-prioritization-in-sidekiq/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Unlike <a href="https://github.com/defunkt/resque">Resque</a>, <a href="http://mperham.github.com/sidekiq/">Sidekiq</a> allows you to process several queues at the same time. You can even assign priorities. Here&#8217;s an example from default config:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">:queues</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">often</span><span class="p-Indicator">,</span> <span class="nv">7</span><span class="p-Indicator">]</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">default</span><span class="p-Indicator">,</span> <span class="nv">5</span><span class="p-Indicator">]</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">seldom</span><span class="p-Indicator">,</span> <span class="nv">3</span><span class="p-Indicator">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you want two queues have equal rights, just set the same priorities. However, if you omit priority parameter and define your queues like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">:queues</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">email</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">coffee</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">billing</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then queues will be checked in a serial manner. That is, Sidekiq will start making coffee only when all emails are sent. If a new email shows up, it will be processed before any other job. In other words, this is how Resque would handle the queues.</p>

<p>Choose whatever fits your task better. It&#8217;s nice to have some flexibility.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2014/03/useful-documentation-lookup-tools/">Useful documentation lookup tools</a>
      </li>
    
      <li class="post">
        <a href="/2014/02/limitations-of-mongodb/">Limitations of MongoDB</a>
      </li>
    
      <li class="post">
        <a href="/2014/02/kata-convert-numbers-to-roman-numerals/">Kata: Convert numbers to Roman numerals</a>
      </li>
    
      <li class="post">
        <a href="/2014/02/what-is-utf-8-for-the-dummies/">What is UTF-8 (for the dummies)</a>
      </li>
    
      <li class="post">
        <a href="/2013/11/pipeline-processing-in-go/">Pipeline processing in Go</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("stulentsev", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/stulentsev" class="twitter-follow-button" data-show-count="false">Follow @stulentsev</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/115058022574940748667?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Sergio Tulentsev -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'software-and-computers';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>







</body>
</html>
